<!doctype html>
<html lang="pt-br">
    <head>
        <title>LibNet - Моя Сторінка</title>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.css" />
        <script src="https://kit.fontawesome.com/999afff8dc.js" crossorigin="anonymous"></script>
        <!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    </head>
    
    <body>
{% include 'navbar.html' %}
        
<style>
    body, html{
        min-height:100%;
        min-width: 100%;
    }
    
    .user-photo{
        display: inline-block;
        margin-left: 50px;
        margin-top: 20px;
        top: 0;
        position: -webkit-sticky;
        position: sticky;
    }
    
    .user-avatar{
        height: 200px;
        border-radius: 100px;
    }
    
    .info{
        display: flex;
        justify-content: space-around;
        flex-direction: row;
    }
    
    .stat{
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
        font-size: 11px;
        font-weight: bold;
        letter-spacing: 1px;
        text-transform: uppercase;
    }
    
    i{
        position: inherit;
    }
    
</style>

{% if g.user.avatar %}
<div style="max-width: 100%;">
<div class="user-photo">
  <img class="user-avatar"  src="{{ g.user.avatar }}" >
  <p style="margin: auto; text-align: center; font-size: 24px; font-weight: 500;">{{ g.user.username }} <!--<i class="fa fa-pencil" style="font-size: 14px; color: darkgrey; margin-left: 3px;"></i> --> </p> 
    <hr style="margin-top: 3px;">
    <div class="info">
        <div class="stat">
            <div class="label">Пости</div>
            <div class="num">{{ n_posts }}</div>
          </div>
        <div class="stat">
            <div class="label">Підписники</div>
            <div class="num">0</div>
        </div>
    </div>
</div>
{% else %}
    
     
<!--This is for taking picture input form user -->
<form method="post">
<div class="row">
    <div class="col-lg-12">
        <div class="jumbotron text-center" style="background-color: transparent; padding: 0; margin-left: 80px; margin-top: 10px; margin-bottom: 0px;">
            <div class="row">
                <div class="input-group mt-3">
                    <div class="custom-file">
                        <p style="margin-right: 10px; font-size: 18px; font-weight: 500; padding-top: 10px;">Створіть аватарку: </p>
                        <input type="file" accept="image/*" id="cover_image" hidden>
                        <label for="cover_image">Обрати файл</label>
                        <span id="file-chosen">Файл не обрано.</span>
                        <style>
                        label {
                          width: 130px;
                            height: 37px;
                            border-radius: 7px;
                            background-color: #2A3A51;
                            color: white;
                            padding-top: 4px;
                        }
                            
                        #file-chosen{
                          margin-left: 7px;
                            margin-top: -2px;
                          font-family: sans-serif;
                        }
                        </style>
                        
                        <script>
                        const actualBtn = document.getElementById('cover_image');

                        const fileChosen = document.getElementById('file-chosen');

                        actualBtn.addEventListener('change', function(){
                          fileChosen.textContent = this.files[0].name
                        })
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="uploadimageModal">
    <div class="modal-dialog" role="document" style="min-width: 700px">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Створіть аватарку</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12 text-center">
                        <div id="image_demo"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary crop_image submit-button">Зберегти</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрити</button>
            </div>
        </div>
    </div>
</div>
</form> 
        
{% endif %}            
        
        
 <!-- ||||||||||||||||||||||||||||||||||||||||||||| -->       
 
<style>
    .profile-content{
        display: inline-block;
        position: absolute;
        margin-left: 80px;
        margin-top: 20px;
        width: 60%;
    }
</style>
    
<style>
        
        .tab-content{
           display: block;
        width: 100%;
       }
        
        .students{
            display: flex;
            flex-wrap: wrap;
        }
        
        .li-book{
            margin-left: 50px;
        }
        
        .book:hover{
            text-decoration: none;
        }
    
        .book-button{
            background-color: transparent;
            border: 0;
        } 
        .book-button:hover{
            color: grey;
        }
        
    </style>
 
<div class="profile-content">
    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
      <li class="nav-item" role="presentation">
        <a class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true">Улюблені книги</a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false">Улюблені пости</a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" href="#pills-contact" role="tab" aria-controls="pills-contact" aria-selected="false">Улюблені цитати</a>
      </li>
    </ul>
    <div class="tab-content" id="pills-tabContent">
        
        <!-- |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| -->
        
      <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
        {% if books %}
            <ol class="students" style="list-style: none; padding: 0px;">
                {% for book in books %}
                    <li class="li-book"><a class="book"  href="{{ url_for('book', id=book.id) }}">
                        {% if book.image %}
                        <img class="book-img"  src="{{ book.image }}">
                        {% else %}
                        <img class="book-img"  src="../static/img/book.svg">
                        {% endif %}
                        <p class="book-ref">{{ book.name }}</p></a>
                    </li>
                {% endfor %}
            </ol>
          {% else %}
          <hr style="border-top: 2px solid #2A3A51; background-color: transparent; opacity: 1;">
            <div>У Вас поки що немає улюблених книг.</div>
          {% endif %} 
      </div>
        
        <!-- |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| -->
        
      <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
        <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
        {% if posts %}
            <ul class="posts" style="padding: 0px;">
                {% for post in posts|reverse %}
                <hr style="border-top: 2px solid #2A3A51; background-color: transparent; opacity: 1;">
                    <li class="post" style="padding: 0px; list-style: none;">
                        <div style="display: flex; justify-content: space-between;">
                        <p><b>{{ post.title }}</b></p>
                        <form method="post">
                    <input name = "p_id" id = "p_id" style="display:none;" value = "{{ post.id }}">    
                            
                    <button class="edit-delete-button delete-post" formaction="{{ url_for('delete_post', id=post.id) }}" ><i class="far fa-trash-alt" style="margin-right: 6px;"></i>delete</button>
                            {%  if post.is_favorite %}
                <button formaction="{{ url_for('add_post_to_favorites', id=post.id) }}" style="border: 0; background-color: transparent;"><i class="fas fa-star"></i></button>
                    
                    {%  else %}
                <button formaction="{{ url_for('add_post_to_favorites', id=post.id) }}" style="border: 0; background-color: transparent;"><i class="far fa-star"></i></button>
                    {%  endif %}
                    </form>
                        </div>
                    <p style="text-align: justify;">{{ post.body }}</p>
                    <p style="text-align: right; color: darkgray; font-size: 13px;">{{ post.date }}</p>
                    </li>
                
                <style>
                button:active, button:focus {
                  outline: none;
                }
                button::-moz-focus-inner {
                  border: 0;
                }</style>
                {% endfor %}
            </ul>
          {% else %}
            <hr style="border-top: 2px solid #2A3A51; background-color: transparent; opacity: 1;">
            <div>У Вас поки що немає улюблених постів.</div>
          {% endif %} 
      </div>
        </div>
        
        <!-- |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| -->
        
    <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
        
    {% if quotes %}
        <ol class="quotes">
            {% for q in quotes %}
            <hr style="border-top: 2px solid #2A3A51; background-color: transparent; opacity: 1;">
                <li class="quote-div"><div id = "quote-text-div">{{ q.text }}</div>
                    <div id="contain" style="display: flex; align-items: center; justify-content: center;">
                        <div id="min-contain">
                            <form method="post" style="display: flex;">
                            <input name = "q_id" id = "q_id" style="display:none;" value = "{{q.id}}">
                            <button class="book-button" formaction="{{ url_for('delete_quote', id=q.book_id) }}"><i class="far fa-trash-alt" style="margin-right: 6px;"></i></button>
                            <!-- <button class="book-button"><i class="far fa-edit"></i></button> -->
                            {%  if q.is_favorite %}
                            <button formaction="{{ url_for('add_quote_to_favorites', id=q.id) }}" style="border: 0; background-color: transparent;"><i class="fas fa-star"></i></button>

                            {%  else %}
                                
                            <button formaction="{{ url_for('add_quote_to_favorites', id=q.id) }}" style="border: 0; background-color: transparent;"><i class="far fa-star"></i></button>
                            {%  endif %}
                            </form>
                        </div>
                    </div>
                </li>
            
            {% endfor %}
        </ol>
        {% else %}
            <hr style="border-top: 2px solid #2A3A51; background-color: transparent; opacity: 1;">
            <p>У Вас поки що немає улюблених цитат.</p>
        {% endif %}    
        
        </div>
    </div>       
</div>
  </div>      
 <!-- ||||||||||||||||||||||||||||||||||||||||||||| -->
    
<!-- All Sctipt File -->
<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script>
var image_crop = $('#image_demo').croppie({
    viewport: {
        width: 300,
        height: 300,
        type:'circle'
    },
    boundary:{
        width: 650,
        height: 350
    }
});
/// catching up the cover_image change event and binding the image into my croppie. Then show the modal.
$('#cover_image').on('change', function(){
    var reader = new FileReader();
    reader.onload = function (event) {
        image_crop.croppie('bind', {
            url: event.target.result,
        });
    }
    reader.readAsDataURL(this.files[0]);
    $('#uploadimageModal').modal('show');
});
    
    /// Get button click event and get the current crop image
$('.crop_image').click(function(event){
    var formData = new FormData();
    image_crop.croppie('result', {type: 'blob', format: 'png'}).then(function(blob) {
        formData.append('cropped_image', blob);
        ajaxFormPost(formData, '/upload_image'); /// Calling my ajax function with my blob data passed to it
    });
    $('#uploadimageModal').modal('hide');
});
/// Ajax Function
function ajaxFormPost(formData, actionURL){
    $.ajax({
        url: actionURL,
        type: 'POST',
        data: formData,
        cache: false,
        async: true,
        processData: false,
        contentType: false,
        timeout: 5000,
        beforeSend: function(){
        },
        success: function(response) {
            if (response['status'] === 'success') {
///Some Fancy UI, that you won't probably need
                swal({
                    title:'Success!',
                    text: response['message'],
                    type:'success',
                    timer:2000
                }).then(function() {
/// But this part you may need, reset the input value and put the cropped image inside my image attribute.
                    $('#cover_image').val("");
                    $('#uploaded-image').attr('src', response['url']);
                },function(){
                });
            } 
        },
        complete: function(){
        }
    });
}
</script>
        
    </body>
</html>